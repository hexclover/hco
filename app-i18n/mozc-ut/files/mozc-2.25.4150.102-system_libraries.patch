--- /src/gyp/defines.gypi
+++ /src/gyp/defines.gypi
@@ -63,6 +63,15 @@
     # use_libibus represents if ibus library is used or not.
     # This option is only for Linux.
     'use_libibus%': '0',
+
+    # use_libgtest represents if gtest library is used or not.
+    'use_libgtest%': '0',
+
+    # use_libjsoncpp represents if jsoncpp library is used or not.
+    'use_libjsoncpp%': '0',
+
+    # use_libabseilcpp represents if abseilcpp library is used or not.
+    'use_libabseilcpp%': '0',
   },
   'target_defaults': {
     'defines': [
--- /src/net/jsoncpp.gyp
+++ /src/net/jsoncpp.gyp
@@ -31,32 +31,57 @@
   'targets': [
     {
       'target_name': 'jsoncpp',
-      'type': 'static_library',
-      'variables': {
-        'jsoncpp_root': '<(third_party_dir)/jsoncpp',
-        'jsoncpp_srcs': [
-          '<(jsoncpp_root)/src/lib_json/json_reader.cpp',
-          '<(jsoncpp_root)/src/lib_json/json_value.cpp',
-          '<(jsoncpp_root)/src/lib_json/json_writer.cpp',
-        ],
-        'jsoncpp_include_dirs': ['<(jsoncpp_root)/include'],
-        'jsoncpp_additional_macros': ['JSON_USE_EXCEPTION=0'],
-      },
-      'defines': [
-        '<@(jsoncpp_additional_macros)',
+      'conditions': [
+        ['use_libjsoncpp==1', {
+          'type': 'none',
+          'variables': {
+            'jsoncpp_additional_macros': ['JSON_USE_EXCEPTION=0'],
+          },
+          'all_dependent_settings': {
+            'defines': [
+              '<@(jsoncpp_additional_macros)',
+            ],
+            'cflags': [
+              '<!@(pkg-config --cflags jsoncpp)',
+            ],
+            'link_settings': {
+              'libraries': [
+                '<!@(pkg-config --libs-only-l jsoncpp)',
+              ],
+              'ldflags': [
+                '<!@(pkg-config --libs-only-L jsoncpp)',
+              ],
+            }
+          },
+        }, {
+          'type': 'static_library',
+          'variables': {
+            'jsoncpp_root': '<(third_party_dir)/jsoncpp',
+            'jsoncpp_srcs': [
+              '<(jsoncpp_root)/src/lib_json/json_reader.cpp',
+              '<(jsoncpp_root)/src/lib_json/json_value.cpp',
+              '<(jsoncpp_root)/src/lib_json/json_writer.cpp',
+            ],
+            'jsoncpp_include_dirs': ['<(jsoncpp_root)/include'],
+            'jsoncpp_additional_macros': ['JSON_USE_EXCEPTION=0'],
+          },
+          'defines': [
+            '<@(jsoncpp_additional_macros)',
+          ],
+          'sources': [
+            '<@(jsoncpp_srcs)',
+            'jsoncpp.h',
+          ],
+          'include_dirs': [
+            '<@(jsoncpp_include_dirs)',
+          ],
+          'all_dependent_settings': {
+            'defines': [
+              '<@(jsoncpp_additional_macros)',
+            ],
+          },
+        }],
       ],
-      'sources': [
-        '<@(jsoncpp_srcs)',
-        'jsoncpp.h',
-      ],
-      'include_dirs': [
-        '<@(jsoncpp_include_dirs)',
-      ],
-      'all_dependent_settings': {
-        'defines': [
-          '<@(jsoncpp_additional_macros)',
-        ],
-      },
     },
   ],
 }
--- /src/net/jsoncpp.h
+++ /src/net/jsoncpp.h
@@ -35,7 +35,7 @@
 // Mozc basically disables C++ exception.
 #define JSON_USE_EXCEPTION 0
 #endif  // !JSON_USE_EXCEPTION
-#include "third_party/jsoncpp/include/json/json.h"
+#include <json/json.h>
 #define MOZC_JSONCPP_JSON_H_INCLUDED
 #endif  // !MOZC_JSONCPP_JSON_H_INCLUDED
 
--- /src/testing/testing.gyp
+++ /src/testing/testing.gyp
@@ -59,48 +59,6 @@
   'targets': [
     {
       'target_name': 'testing',
-      'type': 'static_library',
-      'variables': {
-        'gtest_defines': [
-          'GTEST_LANG_CXX11=1',
-          'GTEST_HAS_TR1_TUPLE=0',  # disable tr1 tuple in favor of C++11 tuple.
-        ],
-        'gtest_dir': '<(third_party_dir)/gtest/googletest',
-        'gmock_dir': '<(third_party_dir)/gtest/googlemock',
-      },
-      'sources': [
-        '<(gmock_dir)/src/gmock-cardinalities.cc',
-        '<(gmock_dir)/src/gmock-internal-utils.cc',
-        '<(gmock_dir)/src/gmock-matchers.cc',
-        '<(gmock_dir)/src/gmock-spec-builders.cc',
-        '<(gmock_dir)/src/gmock.cc',
-        '<(gtest_dir)/src/gtest-death-test.cc',
-        '<(gtest_dir)/src/gtest-filepath.cc',
-        '<(gtest_dir)/src/gtest-matchers.cc',
-        '<(gtest_dir)/src/gtest-port.cc',
-        '<(gtest_dir)/src/gtest-printers.cc',
-        '<(gtest_dir)/src/gtest-test-part.cc',
-        '<(gtest_dir)/src/gtest-typed-test.cc',
-        '<(gtest_dir)/src/gtest.cc',
-      ],
-      'include_dirs': [
-        '<(gmock_dir)',
-        '<(gmock_dir)/include',
-        '<(gtest_dir)',
-        '<(gtest_dir)/include',
-      ],
-      'defines': [
-        '<@(gtest_defines)',
-      ],
-      'all_dependent_settings': {
-        'defines': [
-          '<@(gtest_defines)',
-        ],
-        'include_dirs': [
-          '<(gmock_dir)/include',
-          '<(gtest_dir)/include',
-        ],
-      },
       'conditions': [
         ['(_toolset=="target" and compiler_target=="clang") or '
          '(_toolset=="host" and compiler_host=="clang")', {
@@ -109,6 +67,67 @@
             '-Wno-unused-private-field',
           ],
         }],
+        ['use_libgtest==1', {
+          'type': 'none',
+          'variables': {
+            'gtest_defines': [
+              'GTEST_LANG_CXX11=1',
+              'GTEST_HAS_TR1_TUPLE=0',  # disable tr1 tuple in favor of C++11 tuple.
+            ],
+          },
+          'all_dependent_settings': {
+            'defines': [
+              '<@(gtest_defines)',
+            ],
+            'link_settings': {
+              'libraries': [
+                '-lgmock -lgtest',
+              ],
+            },
+          },
+        }, {
+          'type': 'static_library',
+          'variables': {
+            'gtest_defines': [
+              'GTEST_LANG_CXX11=1',
+              'GTEST_HAS_TR1_TUPLE=0',  # disable tr1 tuple in favor of C++11 tuple.
+            ],
+            'gtest_dir': '<(third_party_dir)/gtest/googletest',
+            'gmock_dir': '<(third_party_dir)/gtest/googlemock',
+          },
+          'sources': [
+            '<(gmock_dir)/src/gmock-cardinalities.cc',
+            '<(gmock_dir)/src/gmock-internal-utils.cc',
+            '<(gmock_dir)/src/gmock-matchers.cc',
+            '<(gmock_dir)/src/gmock-spec-builders.cc',
+            '<(gmock_dir)/src/gmock.cc',
+            '<(gtest_dir)/src/gtest-death-test.cc',
+            '<(gtest_dir)/src/gtest-filepath.cc',
+            '<(gtest_dir)/src/gtest-port.cc',
+            '<(gtest_dir)/src/gtest-printers.cc',
+            '<(gtest_dir)/src/gtest-test-part.cc',
+            '<(gtest_dir)/src/gtest-typed-test.cc',
+            '<(gtest_dir)/src/gtest.cc',
+          ],
+          'include_dirs': [
+            '<(gmock_dir)',
+            '<(gmock_dir)/include',
+            '<(gtest_dir)',
+            '<(gtest_dir)/include',
+          ],
+          'defines': [
+            '<@(gtest_defines)',
+          ],
+          'all_dependent_settings': {
+            'defines': [
+              '<@(gtest_defines)',
+            ],
+            'include_dirs': [
+              '<(gmock_dir)/include',
+              '<(gtest_dir)/include',
+            ],
+          }
+        }],
       ],
     },
     {

--- /src/base/absl.gyp
+++ /src/base/absl.gyp
@@ -35,80 +35,133 @@
   'targets': [
     {
       'target_name': 'absl_base',
-      'type': 'static_library',
       'toolsets': ['host', 'target'],
-      'sources': [
-        '<(absl_srcdir)/base/internal/cycleclock.cc',
-        '<(absl_srcdir)/base/internal/low_level_alloc.cc',
-        '<(absl_srcdir)/base/internal/raw_logging.cc',
-        '<(absl_srcdir)/base/internal/spinlock.cc',
-        '<(absl_srcdir)/base/internal/spinlock_wait.cc',
-        '<(absl_srcdir)/base/internal/sysinfo.cc',
-        '<(absl_srcdir)/base/internal/thread_identity.cc',
-        '<(absl_srcdir)/base/internal/throw_delegate.cc',
-        '<(absl_srcdir)/base/internal/unscaledcycleclock.cc',
-      ],
       'msvs_disabled_warnings': [
         # 'type' : forcing value to bool 'true' or 'false'
         # (performance warning)
         # http://msdn.microsoft.com/en-us/library/b6801kcy.aspx
         '4800',
       ],
+      'conditions': [
+        ['use_libabseilcpp==1', {
+          'type': 'none',
+          'all_dependent_settings': {
+             'link_settings': {
+               'libraries': [
+                 '-labsl_base',
+               ],
+             },
+          },
+        }, {
+          'type': 'static_library',
+          'sources': [
+            '<(absl_srcdir)/base/internal/cycleclock.cc',
+            '<(absl_srcdir)/base/internal/low_level_alloc.cc',
+            '<(absl_srcdir)/base/internal/raw_logging.cc',
+            '<(absl_srcdir)/base/internal/spinlock.cc',
+            '<(absl_srcdir)/base/internal/spinlock_wait.cc',
+            '<(absl_srcdir)/base/internal/sysinfo.cc',
+            '<(absl_srcdir)/base/internal/thread_identity.cc',
+            '<(absl_srcdir)/base/internal/throw_delegate.cc',
+            '<(absl_srcdir)/base/internal/unscaledcycleclock.cc',
+          ]
+        }]
+      ]
     },
     {
       'target_name': 'absl_numeric',
-      'type': 'static_library',
-      'toolsets': ['host', 'target'],
-      'sources': [
-        '<(absl_srcdir)/numeric/int128.cc',
-      ],
       'dependencies': [
         'absl_base',
       ],
+      'toolsets': ['host', 'target'],
+      'conditions': [
+        ['use_libabseilcpp==1', {
+          'type': 'none',
+          'all_dependent_settings': {
+             'link_settings': {
+               'libraries': [
+                 '-labsl_int128',
+               ],
+             },
+          },
+        }, {
+          'type': 'static_library',
+          'sources': [
+            '<(absl_srcdir)/numeric/int128.cc',
+          ],
+        }],
+      ]
     },
     {
       'target_name': 'absl_strings_internal',
-      'type': 'static_library',
       'toolsets': ['host', 'target'],
-      'sources': [
-        '<(absl_srcdir)/strings/internal/charconv_bigint.cc',
-        '<(absl_srcdir)/strings/internal/charconv_parse.cc',
-        '<(absl_srcdir)/strings/internal/escaping.cc',
-        '<(absl_srcdir)/strings/internal/memutil.cc',
-        '<(absl_srcdir)/strings/internal/str_format/arg.cc',
-        '<(absl_srcdir)/strings/internal/str_format/bind.cc',
-        '<(absl_srcdir)/strings/internal/str_format/extension.cc',
-        '<(absl_srcdir)/strings/internal/str_format/float_conversion.cc',
-        '<(absl_srcdir)/strings/internal/str_format/output.cc',
-        '<(absl_srcdir)/strings/internal/str_format/parser.cc',
-        '<(absl_srcdir)/strings/internal/utf8.cc',
-      ],
       'dependencies': [
         'absl_base',
         'absl_numeric',
       ],
+      'conditions': [
+        ['use_libabseilcpp==1', {
+          'type': 'none',
+          'all_dependent_settings': {
+             'link_settings': {
+               'libraries': [
+                 '-labsl_strings_internal',
+		  '-labsl_str_format_internal',
+               ],
+             },
+          },
+        }, {
+          'type': 'static_library',
+          'sources': [
+            '<(absl_srcdir)/strings/internal/charconv_bigint.cc',
+            '<(absl_srcdir)/strings/internal/charconv_parse.cc',
+            '<(absl_srcdir)/strings/internal/escaping.cc',
+            '<(absl_srcdir)/strings/internal/memutil.cc',
+            '<(absl_srcdir)/strings/internal/str_format/arg.cc',
+            '<(absl_srcdir)/strings/internal/str_format/bind.cc',
+            '<(absl_srcdir)/strings/internal/str_format/extension.cc',
+            '<(absl_srcdir)/strings/internal/str_format/float_conversion.cc',
+            '<(absl_srcdir)/strings/internal/str_format/output.cc',
+            '<(absl_srcdir)/strings/internal/str_format/parser.cc',
+            '<(absl_srcdir)/strings/internal/utf8.cc',
+          ],
+        }],
+      ],
     },
     {
       'target_name': 'absl_strings',
-      'type': 'static_library',
       'toolsets': ['host', 'target'],
-      'sources': [
-        '<(absl_srcdir)/strings/ascii.cc',
-        '<(absl_srcdir)/strings/charconv.cc',
-        '<(absl_srcdir)/strings/escaping.cc',
-        '<(absl_srcdir)/strings/match.cc',
-        '<(absl_srcdir)/strings/numbers.cc',
-        '<(absl_srcdir)/strings/str_cat.cc',
-        '<(absl_srcdir)/strings/str_replace.cc',
-        '<(absl_srcdir)/strings/str_split.cc',
-        '<(absl_srcdir)/strings/string_view.cc',
-        '<(absl_srcdir)/strings/substitute.cc',
-      ],
       'dependencies': [
         'absl_base',
         'absl_numeric',
         'absl_strings_internal',
       ],
+      'conditions': [
+        ['use_libabseilcpp==1', {
+          'type': 'none',
+          'all_dependent_settings': {
+             'link_settings': {
+               'libraries': [
+                 '-labsl_strings',
+               ],
+             },
+          },
+        }, {
+          'type': 'static_library',
+          'sources': [
+            '<(absl_srcdir)/strings/ascii.cc',
+            '<(absl_srcdir)/strings/charconv.cc',
+            '<(absl_srcdir)/strings/escaping.cc',
+            '<(absl_srcdir)/strings/match.cc',
+            '<(absl_srcdir)/strings/numbers.cc',
+            '<(absl_srcdir)/strings/str_cat.cc',
+            '<(absl_srcdir)/strings/str_replace.cc',
+            '<(absl_srcdir)/strings/str_split.cc',
+            '<(absl_srcdir)/strings/string_view.cc',
+            '<(absl_srcdir)/strings/substitute.cc',
+          ],
+        }],
+      ],
     },
   ],
 }
